{
    "swagger": "2.0",
    "info": {
        "description": "A modular HTTP API server that uses eBPF to monitor network connections with an extensible plugin architecture.\n\n## Features\n- **Plugin-style eBPF Programs**: Independent, hot-swappable monitoring modules\n- **Event Storage**: Unified event collection and querying across all programs\n- **Manager-based Lifecycle**: Centralized program registration and management\n- **Auto-generated Documentation**: This documentation is generated from code annotations\n\n## Adding New Programs\nNew eBPF monitoring programs can be added by implementing the `BPFProgram` interface.\nSee the [Program Development Guide](https://github.com/srodi/ebpf-server/blob/main/docs/program-development.md) for detailed instructions.\n\n## Authentication\nThis API currently does not require authentication. Consider adding authentication for production deployments.",
        "title": "eBPF Network Monitor API",
        "contact": {
            "name": "API Support",
            "url": "https://github.com/srodi/ebpf-server/issues",
            "email": "support@example.com"
        },
        "license": {
            "name": "MIT",
            "url": "https://github.com/srodi/ebpf-server/blob/main/LICENSE"
        },
        "version": "1.0"
    },
    "host": "localhost:8080",
    "basePath": "/",
    "paths": {
        "/api/connection-summary": {
            "post": {
                "description": "Returns the count of connection events within a specified time window, filtered by PID or command",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "connections"
                ],
                "summary": "Get connection event statistics",
                "parameters": [
                    {
                        "description": "Connection summary request",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.ConnectionSummaryRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.ConnectionSummaryResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "405": {
                        "description": "Method Not Allowed",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/events": {
            "get": {
                "description": "Returns events from all eBPF programs with optional filtering by PID, command, event type, and time window",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "events"
                ],
                "summary": "Query events across all programs",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Process ID to filter by",
                        "name": "pid",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Command name to filter by",
                        "name": "command",
                        "in": "query"
                    },
                    {
                        "type": "string",
                        "description": "Event type to filter by (e.g., 'connection', 'packet_drop')",
                        "name": "event_type",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "default": 300,
                        "description": "Time window in seconds (default: 300)",
                        "name": "duration",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "default": 100,
                        "description": "Maximum number of events to return (default: 100)",
                        "name": "limit",
                        "in": "query"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/list-connections": {
            "get": {
                "description": "Returns connection events with optional filtering by PID and limiting results. Supports both GET (query parameters) and POST (JSON body) methods.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "connections"
                ],
                "summary": "List connection events",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Process ID to filter by",
                        "name": "pid",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "description": "Maximum connections to return per PID (default: 100, max: 1000)",
                        "name": "limit",
                        "in": "query"
                    },
                    {
                        "description": "Connections list request (POST only)",
                        "name": "request",
                        "in": "body",
                        "schema": {
                            "$ref": "#/definitions/api.ListConnectionsRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.ListConnectionsResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "405": {
                        "description": "Method Not Allowed",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            },
            "post": {
                "description": "Returns connection events with optional filtering by PID and limiting results. Supports both GET (query parameters) and POST (JSON body) methods.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "connections"
                ],
                "summary": "List connection events",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Process ID to filter by",
                        "name": "pid",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "description": "Maximum connections to return per PID (default: 100, max: 1000)",
                        "name": "limit",
                        "in": "query"
                    },
                    {
                        "description": "Connections list request (POST only)",
                        "name": "request",
                        "in": "body",
                        "schema": {
                            "$ref": "#/definitions/api.ListConnectionsRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.ListConnectionsResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "405": {
                        "description": "Method Not Allowed",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/list-packet-drops": {
            "get": {
                "description": "Returns packet drop events with optional filtering by PID and limiting results. Supports both GET (query parameters) and POST (JSON body) methods.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "packet_drops"
                ],
                "summary": "List packet drop events",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Process ID to filter by",
                        "name": "pid",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "description": "Maximum packet drops to return per PID (default: 100, max: 1000)",
                        "name": "limit",
                        "in": "query"
                    },
                    {
                        "description": "Packet drops list request (POST only)",
                        "name": "request",
                        "in": "body",
                        "schema": {
                            "$ref": "#/definitions/api.ListPacketDropsRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.ListPacketDropsResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "405": {
                        "description": "Method Not Allowed",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            },
            "post": {
                "description": "Returns packet drop events with optional filtering by PID and limiting results. Supports both GET (query parameters) and POST (JSON body) methods.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "packet_drops"
                ],
                "summary": "List packet drop events",
                "parameters": [
                    {
                        "type": "integer",
                        "description": "Process ID to filter by",
                        "name": "pid",
                        "in": "query"
                    },
                    {
                        "type": "integer",
                        "description": "Maximum packet drops to return per PID (default: 100, max: 1000)",
                        "name": "limit",
                        "in": "query"
                    },
                    {
                        "description": "Packet drops list request (POST only)",
                        "name": "request",
                        "in": "body",
                        "schema": {
                            "$ref": "#/definitions/api.ListPacketDropsRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.ListPacketDropsResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "405": {
                        "description": "Method Not Allowed",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/packet-drop-summary": {
            "post": {
                "description": "Returns the count of packet drop events within a specified time window, filtered by PID or command",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "packet_drops"
                ],
                "summary": "Get packet drop event statistics",
                "parameters": [
                    {
                        "description": "Packet drop summary request",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/api.PacketDropSummaryRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.PacketDropSummaryResponse"
                        }
                    },
                    "400": {
                        "description": "Bad Request",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    },
                    "405": {
                        "description": "Method Not Allowed",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/api/programs": {
            "get": {
                "description": "Returns information about all currently registered and running eBPF programs",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "programs"
                ],
                "summary": "List active eBPF programs",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "$ref": "#/definitions/api.ProgramsResponse"
                        }
                    },
                    "500": {
                        "description": "Internal Server Error",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        },
        "/health": {
            "get": {
                "description": "Returns the health status of the eBPF server and active programs",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "health"
                ],
                "summary": "Health check",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "object",
                            "additionalProperties": {
                                "type": "string"
                            }
                        }
                    },
                    "405": {
                        "description": "Method Not Allowed",
                        "schema": {
                            "$ref": "#/definitions/api.ErrorResponse"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "api.ConnectionInfo": {
            "type": "object",
            "properties": {
                "command": {
                    "type": "string",
                    "example": "curl"
                },
                "destination": {
                    "type": "string",
                    "example": "192.168.1.100:80"
                },
                "pid": {
                    "type": "integer",
                    "example": 1234
                },
                "protocol": {
                    "type": "string",
                    "example": "TCP"
                },
                "return_code": {
                    "type": "integer",
                    "example": 0
                },
                "timestamp": {
                    "type": "string",
                    "example": "2023-08-04T10:15:30Z"
                }
            }
        },
        "api.ConnectionSummaryRequest": {
            "type": "object",
            "properties": {
                "command": {
                    "type": "string",
                    "example": "curl"
                },
                "duration": {
                    "type": "integer",
                    "example": 60
                },
                "pid": {
                    "type": "integer",
                    "example": 1234
                },
                "process_name": {
                    "type": "string",
                    "example": "curl"
                }
            }
        },
        "api.ConnectionSummaryResponse": {
            "type": "object",
            "properties": {
                "command": {
                    "type": "string",
                    "example": "curl"
                },
                "duration": {
                    "type": "integer",
                    "example": 60
                },
                "message": {
                    "type": "string",
                    "example": "Found 42 connection attempts in the last 60 seconds"
                },
                "pid": {
                    "type": "integer",
                    "example": 1234
                },
                "total_attempts": {
                    "type": "integer",
                    "example": 42
                }
            }
        },
        "api.ErrorResponse": {
            "type": "object",
            "properties": {
                "error": {
                    "type": "string",
                    "example": "Bad Request"
                },
                "message": {
                    "type": "string",
                    "example": "Invalid parameter value"
                }
            }
        },
        "api.ListConnectionsRequest": {
            "type": "object",
            "properties": {
                "limit": {
                    "description": "Optional: Maximum connections to return per PID (default: 100, max: 1000)",
                    "type": "integer",
                    "example": 100
                },
                "pid": {
                    "description": "Optional: Filter connections for specific Process ID",
                    "type": "integer",
                    "example": 1234
                }
            }
        },
        "api.ListConnectionsResponse": {
            "type": "object",
            "properties": {
                "connections": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "array",
                        "items": {
                            "$ref": "#/definitions/api.ConnectionInfo"
                        }
                    }
                },
                "message": {
                    "type": "string",
                    "example": "Found 15 total connections across 2 processes"
                },
                "total_pids": {
                    "type": "integer",
                    "example": 2
                },
                "truncated": {
                    "type": "boolean",
                    "example": false
                }
            }
        },
        "api.ListPacketDropsRequest": {
            "type": "object",
            "properties": {
                "limit": {
                    "description": "Optional: Maximum drops to return per PID (default: 100, max: 1000)",
                    "type": "integer",
                    "example": 100
                },
                "pid": {
                    "description": "Optional: Filter drops for specific Process ID",
                    "type": "integer",
                    "example": 1234
                }
            }
        },
        "api.ListPacketDropsResponse": {
            "type": "object",
            "properties": {
                "drops": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "array",
                        "items": {
                            "$ref": "#/definitions/api.PacketDropInfo"
                        }
                    }
                },
                "message": {
                    "type": "string",
                    "example": "Found 25 packet drops across 3 processes"
                },
                "total_pids": {
                    "type": "integer",
                    "example": 3
                },
                "truncated": {
                    "type": "boolean",
                    "example": false
                }
            }
        },
        "api.PacketDropInfo": {
            "type": "object",
            "properties": {
                "command": {
                    "type": "string",
                    "example": "curl"
                },
                "drop_reason": {
                    "type": "string",
                    "example": "SKB_FREE"
                },
                "pid": {
                    "type": "integer",
                    "example": 1234
                },
                "skb_length": {
                    "type": "integer",
                    "example": 1500
                },
                "timestamp": {
                    "type": "string",
                    "example": "2023-08-04 10:15:30.123 UTC"
                }
            }
        },
        "api.PacketDropSummaryRequest": {
            "type": "object",
            "properties": {
                "command": {
                    "type": "string",
                    "example": "curl"
                },
                "duration": {
                    "type": "integer",
                    "example": 60
                },
                "pid": {
                    "type": "integer",
                    "example": 1234
                },
                "process_name": {
                    "type": "string",
                    "example": "curl"
                }
            }
        },
        "api.PacketDropSummaryResponse": {
            "type": "object",
            "properties": {
                "command": {
                    "type": "string",
                    "example": "curl"
                },
                "duration": {
                    "type": "integer",
                    "example": 60
                },
                "message": {
                    "type": "string",
                    "example": "Found 15 packet drops from command 'curl' over 60 seconds"
                },
                "pid": {
                    "type": "integer",
                    "example": 1234
                },
                "total_drops": {
                    "type": "integer",
                    "example": 15
                }
            }
        },
        "api.ProgramInfo": {
            "type": "object",
            "properties": {
                "description": {
                    "type": "string",
                    "example": "Monitors network connection attempts"
                },
                "event_count": {
                    "type": "integer",
                    "example": 1234
                },
                "name": {
                    "type": "string",
                    "example": "connection"
                },
                "running": {
                    "type": "boolean",
                    "example": true
                }
            }
        },
        "api.ProgramsResponse": {
            "type": "object",
            "properties": {
                "message": {
                    "type": "string",
                    "example": "2 eBPF programs currently active"
                },
                "programs": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/api.ProgramInfo"
                    }
                },
                "total": {
                    "type": "integer",
                    "example": 2
                }
            }
        }
    },
    "tags": [
        {
            "description": "Health check and system status endpoints",
            "name": "health"
        },
        {
            "description": "Network connection monitoring endpoints",
            "name": "connections"
        },
        {
            "description": "Packet drop monitoring endpoints",
            "name": "packet_drops"
        },
        {
            "description": "eBPF program management and information endpoints",
            "name": "programs"
        },
        {
            "description": "Event querying and retrieval endpoints",
            "name": "events"
        }
    ]
}